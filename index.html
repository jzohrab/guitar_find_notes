<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Guessing Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .game-container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        label, select, input {
            display: block;
            margin: 10px 0;
        }
        button {
            margin-top: 20px;
        }
        .note-display {
            font-size: 56px;
            font-weight: bold;
            color: blue;
            margin-top: 20px;
        }
    </style>
    <script>
      const synth = new Tone.Synth().toDestination();

      function startGame() {
        Tone.start();
        let selectedNotes = Array.from(document.getElementById('notes').selectedOptions).map(option => option.value);
        const pauseDuration = parseInt(document.getElementById('pauseDuration').value, 10);
        const qpauseDuration = parseInt(document.getElementById('nextQuestionPauseDuration').value, 10);

        if (selectedNotes.length === 0) {
          alert("Please select at least one note.");
          return;
        }

        shuffleArray(selectedNotes);

        const playNextNote = function() {
          if (selectedNotes.length == 0) {
            const noteDisplay = document.getElementById('noteDisplay');
            noteDisplay.textContent = "Done!";
            return;
          }

          const note = selectedNotes.pop()

          playRandomNote(note, pauseDuration);

          setTimeout(() => { playNextNote(); }, (pauseDuration + qpauseDuration) * 1000);
        };

        playNextNote();
      }

      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function playRandomNote(note, pauseDuration) {
        console.log(`Playing ${note}`);
        const noteDisplay = document.getElementById('noteDisplay');
        noteDisplay.textContent = note;

        const playNote = note + '4';
        synth.triggerAttackRelease("C6", "64n", Tone.now());
        synth.triggerAttackRelease(playNote, "8n", Tone.now() + pauseDuration);
      }



      function populateNotes() {
        const notesArray = [
          'A', 'B', 'C', 'D', 'E', 'F', 'G',
          'Ab', 'Bb', 'Cb', 'Db', 'Eb', 'Fb', 'Gb',
          'A#', 'B#', 'C#', 'D#', 'E#', 'F#', 'G#',
        ];
        const notesSelect = document.getElementById('notes');
        notesArray.forEach(note => {
          const option = document.createElement('option');
          option.value = note;
          option.textContent = note;
          notesSelect.appendChild(option);
        });

        notesSelect.size = notesArray.length;
      }

      window.onload = populateNotes;
    </script>
</head>
<body>
    <div class="game-container">
        <h1>Find notes</h1>
        <form id="gameForm">
            <label for="notes">Select Notes:</label>
            <select id="notes" multiple></select>
            <label for="pauseDuration">Pause before tone (seconds):</label>
            <input type="number" id="pauseDuration" min="1" value="2">
            <label for="nextQuestionPauseDuration">Time between questions (seconds):</label>
            <input type="number" id="nextQuestionPauseDuration" min="1" value="5">
            <button type="button" onclick="startGame()">Start Game</button>
        </form>
        <div class="note-display" id="noteDisplay"></div>
    </div>
</body>
</html>
